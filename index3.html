<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>image_to_name</title>

<!-- <link rel="manifest" href="manifest.json"> -->

<!-- https://taroyanaka.github.io/q_a/sample_data_for_index3.txt -->

<link rel="stylesheet" href="./lib/reset.css">
<script src="./lib/localforage@1.10.0.js"></script>
<script src="./lib/vue@3.2.36.global.prod.js"></script>
<script src="./lib/ramda.@0.28.0.js"></script>

<!-- <script src="https://cdn.jsdelivr.net/npm/localforage@1.10.0/dist/localforage.min.js"></script> -->
<!-- <script src="https://cdn.jsdelivr.net/npm/vue@3.2.45/dist/vue.global.prod.js"></script> -->
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/ramda/0.28.0/ramda.min.js"></script> -->


<style>
:root {
--css-var-root-font-size: 12px;
font-size: var(--css-var-root-font-size);
/* --css-var-test-inline: none; */
}
.app{
width: 100vw;
}
/* content_parent is grid layout of 2 column */
.content_parent{
display: grid;
grid-template-columns: 1fr 1fr;
}
.column-1{
/* column-1 is grid layout of 2 row */
display: grid;
grid-template-rows: 0.1fr 1fr;
}
.textarea_parent{
/* two column with grid layout */
display: grid;
grid-template-columns: 1fr 1fr;
}
textarea{
    /* width: 30rem; */
    height: 30rem;
}
.png_image{
    width: 3rem;
    height: 3rem;
}
.png_image_back{
    background-color: blue;
}
</style>
</head>
<body class="app">
<div class="content_parent">

<div class="column-1">
    <div class="button_list">
        <button @click="sample1">sample1</button>
        <button @click="sample2">sample2</button>
    </div>
    <div class="textarea_parent">
        <textarea v-model="data2"></textarea>
        <textarea v-model="data3"></textarea>
    </div>
</div>

<div class="column-2">
<ul>
<li v-for="(item, IDX) in data5" :key="item" class="result_color">
    <span>{{ item[0] }}</span>
    <!-- <img :src="item[1][0]" :alt="item[0]" class="png_image"> -->
    <span v-for="item2 in item[1][1]">
    <img :src="item2" :alt="item[0]" class="png_image png_image_back" @click="check_image_to_name(item[1][0], item2, IDX)">
    </span>
    <span class="OK_or_NG">{{ item[2] }}</span>
</li>
</ul>
</div>

</div>
</body>
<script>
// https://stackoverflow.com/a/68523152
// TODO: copy and paste mulberry32 and cyrb128 from
//       https://stackoverflow.com/a/47593316/6243352
function cyrb128(str) {
    let h1 = 1779033703, h2 = 3144134277,
        h3 = 1013904242, h4 = 2773480762;
    for (let i = 0, k; i < str.length; i++) {
        k = str.charCodeAt(i);
        h1 = h2 ^ Math.imul(h1 ^ k, 597399067);
        h2 = h3 ^ Math.imul(h2 ^ k, 2869860233);
        h3 = h4 ^ Math.imul(h3 ^ k, 951274213);
        h4 = h1 ^ Math.imul(h4 ^ k, 2716044179);
    }
    h1 = Math.imul(h3 ^ (h1 >>> 18), 597399067);
    h2 = Math.imul(h4 ^ (h2 >>> 22), 2869860233);
    h3 = Math.imul(h1 ^ (h3 >>> 17), 951274213);
    h4 = Math.imul(h2 ^ (h4 >>> 19), 2716044179);
    return [(h1^h2^h3^h4)>>>0, (h2^h1)>>>0, (h3^h1)>>>0, (h4^h1)>>>0];
}
function mulberry32(a) {
    return function() {
      var t = a += 0x6D2B79F5;
      t = Math.imul(t ^ t >>> 15, t | 1);
      t ^= t + Math.imul(t ^ t >>> 7, t | 61);
      return ((t ^ t >>> 14) >>> 0) / 4294967296;
    }
}
const seededRandom = ({rng = null, seed = "apples"} = {}) => {
  rng = rng || mulberry32(cyrb128(seed)[0]);

  const rnd = (lo, hi, defaultHi=1) => {
    if (hi === undefined) {
      hi = lo === undefined ? defaultHi : lo;
      lo = 0;
    }

    return rng() * (hi - lo) + lo;
  };

  const rndInt = (lo, hi) => Math.floor(rnd(lo, hi, 2));

  const shuffle = a => {
    for (let i = a.length - 1; i > 0; i--) {
      const j = rndInt(i + 1);
      const x = a[i];
      a[i] = a[j];
      a[j] = x;
    }
    return a;
  };

  return {rnd, rndInt, shuffle};
};
const {
  rnd, rndInt, shuffle
} = seededRandom({seed: "optional seed string"});

let data1 = null;
let data2 = null;
let data3 = null;
let ary_data2 = null;
let ary_data3 = null;
let data4 = null;
let data5 = null;
let data6 = null;
let data7 = null;
let data8 = null;
let data9 = null;
let data10 = null;



const app = Vue.createApp({
data() {
return {
data1:[
    // ['cat','https://taroyanaka.github.io/q_a/cat.png'],
    // ['dog','https://taroyanaka.github.io/q_a/dog.png'],
    // ['halr','https://taroyanaka.github.io/q_a/halr.png'],
],
data2:'',
ary_data2: [],
data3:'',
ary_data3: [],
data4:[],
data5:[],
data6:[],
data7:[],
data8:[],
data9:[],
data10:[],
test_mode: false,
}},
watch: {
data2: {
    handler() {
        this.init();
    },
    deep: true
},
data3: {
    handler() {
        this.init();
    },
    deep: true
},
},
beforeCreate(){
},
created(){
},
beforeMount(){
},
mounted() {
this.init();
this.for_debug();
this.test_mode === true ? this.test_exe() : null;
},
beforeUpdate() {
},
updated() {
},
methods: {
fn1(){
},
test_exe(){
},
remove(item, ary){
    // 指定した要素を配列から削除するramda.jsを使った1行の関数
    const remove = R.curry((item, ary) => R.filter(R.complement(R.equals(item)), ary));
    return remove(item, ary);
},
take2(ary){
    // 指定した要素から先頭から2つの要素を取り出すramda.jsを使った1行の関数
    const take2 = R.compose(R.take(2), R.drop(1));
    return take2(ary);
},
data2_data3_string_to_array(){
this.ary_data2 = this.data2.split("\n")
this.ary_data3 = this.data3.split("\n")
},
make_image_to_name_Q_A_array(){
this.data4 = this.to_ary(this.ary_data3).map(V=> [V, this.take2(shuffle(this.remove(V, this.ary_data3)))]
)
this.data4 = this.to_ary(this.data4).map(V=> [V[0], shuffle(R.flatten(V))]
);
this.data5 = R.zip(this.ary_data2, this.data4);
// data5のそれぞれの配列の3つ目にfalseを挿入するramda.jsの関数
this.data5 = R.map(R.insert(2, false), this.data5);
},
init(){
this.data2_data3_string_to_array();
this.make_image_to_name_Q_A_array();
},
check_image_to_name(correct_URL, URL, IDX){
this.data5[IDX][2] = correct_URL === URL ? true : false;
},

to_ary(it){
return JSON.parse(JSON.stringify(it));
},
for_debug(){
data1 = this.to_ary(this.data1);
data2 = this.to_ary(this.data2);
data3 = this.to_ary(this.data3);
data4 = this.to_ary(this.data4);
ary_data2 = this.to_ary(this.ary_data2);
ary_data3 = this.to_ary(this.ary_data3);
data5 = this.to_ary(this.data5);
data6 = this.to_ary(this.data6);
data7 = this.to_ary(this.data7);
data8 = this.to_ary(this.data8);
data9 = this.to_ary(this.data9);
data10 = this.to_ary(this.data10);
},

// async save_data_to_all_save(){
// this.all_save.push(this.to_ary([this.data6, this.data3]));
// await localforage.setItem('q_a_1', JSON.stringify(this.all_save));
// },
// async save_data_load() {
// this.all_save = JSON.parse(await localforage.getItem('q_a_1')) || [];
// },
// save_data_set(INDEX){
// this.data6 = this.all_save[INDEX][0];
// this.data3 = this.all_save[INDEX][1];
// },
// async save_data_delete(INDEX){
// if (window.confirm("Do you really want to delete??🦖\n本当に削除する？?🦕\n" + R.zip(this.all_save[INDEX][0].split("\n"), this.all_save[INDEX][1].split("\n")).join("\n") )) {
//     this.all_save.splice(INDEX, 1);
//     await localforage.setItem('q_a_1', JSON.stringify(this.all_save));
// };
// },

sample1(){
this.data2 = `cat
dog
halr
grf
eleph`;
this.data3 = `https://taroyanaka.github.io/q_a/cat.png
https://taroyanaka.github.io/q_a/dog.png
https://taroyanaka.github.io/q_a/halr.png
https://taroyanaka.github.io/q_a/grf.png
https://taroyanaka.github.io/q_a/eleph.png`;
},
sample2(){
this.data2 = `sushi
cake
pink_pixel
paint`;
this.data3 = `https://pbs.twimg.com/media/FpfSgHdaEAE-Ts6?format=jpg
https://pbs.twimg.com/media/FpfRSXQacAARY-a?format=jpg
https://pbs.twimg.com/media/FoaB5b9aUAAXgAU?format=jpg
https://pbs.twimg.com/media/FjuxRy-agAAgAFJ?format=jpg`;
},

},
}).mount('.app');


// 正規表現だけでURLかどうかを判定する関数
function isURL(str) {
    var pattern = new RegExp('^(https?:\\/\\/)?'+ // protocol
    '((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|'+ // domain name
    '((\\d{1,3}\\.){3}\\d{1,3}))'+ // OR ip (v4) address
    '(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*'+ // port and path
    '(\\?[;&a-z\\d%_.~+=-]*)?'+ // query string
    '(\\#[-a-z\\d_]*)?$','i'); // fragment locator
    if(!pattern.test(str)) {
    // alert("URLではありません");
    return false;
    } else {
    return true;
    }
};

</script>
</html>